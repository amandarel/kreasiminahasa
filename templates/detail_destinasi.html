{% extends 'base.html' %}
{% block title %}{{ destinasi_detail.nama }}{% endblock %}
{% block content %}
<section class="detail-page">
  <div class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show mt-3" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <div class="detail-hero">
      <img
        src="{{ url_for('static', filename=destinasi_detail.gambar) }}"
        alt="{{ destinasi_detail.nama }}"
        class="detail-image"
      />
      <h1 class="detail-title">{{ destinasi_detail.nama }}</h1>
    </div>

    <!-- Informasi Detail -->
    <div class="detail-body">
      <div class="row">
        <div class="col-md-8">
          <h3 class="detail-section-heading">Deskripsi</h3>
          <p class="detail-description">{{ destinasi_detail.deskripsi_lengkap }}</p>

          <h3 class="detail-section-heading">Tipe</h3>
                    {% set tipe_mapping = {
                        'Aplikasi': 'aplikasi',
                        'Penerbitan': 'penerbitan',
                        'Seni Pertunjukan': 'seni pertunjukan',
                        'Periklanan': 'periklanan',
                        'Arsitektur': 'arsitektur',
                        'Televisi dan Radio': 'televisi dan radio',
                        'Desain Komunikasi Visual': 'desain komunikasi visual',
                        'Fotografi': 'fotografi',
                        'Film, Animasi, dan Video': 'film, animasi, dan video',
                        'Kuliner': 'kuliner',
                        'Fesyen': 'fesyen',
                        'Desain Product': 'desain product',
                        'Seni Rupa': 'seni rupa',
                        'Musik': 'musik',
                        'Desain Interior': 'desain interior',
                        'Kriya': 'kriya',
                        'Pengembang Permainan': 'pengembang permainan'
                    } %}
                    {% if destinasi_detail.tipe in tipe_mapping %}
                        <p>{{ tipe_mapping[destinasi_detail.tipe] | capitalize }}</p>
                    {% else %}
                        <p>Tipe tidak terdefinisi.</p>
                    {% endif %}
          <h3 class="detail-section-heading">Kontak</h3>
          {% if destinasi_detail.kontak %}
              <p>{{ destinasi_detail.kontak }}</p>
          {% else %}
              <p>Tidak ada informasi kontak yang tersedia.</p>
          {% endif %}

          <h3 class="detail-section-heading">Lokasi</h3>
          <p class="detail-location">
            <i class="fas fa-map-marker-alt"></i> {{ destinasi_detail.lokasi }}
          </p>
          {% if destinasi_detail.map_embed_url %}
            <div class="map-container">
              <iframe
                src="{{ destinasi_detail.map_embed_url }}"
                width="100%"
                height="300"
                style="border: 0"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade">
              </iframe>
           </div>
          {% else %}
           <p>Peta tidak ada.</p>
          {% endif %}
        {% if product %}
        <h3 class="detail-section-heading">Daftar Produk</h3>
            <ul class="product-list">
                {% for kerajinan in product %}
                    <li class="product-item">
                      <img
                        src="{{ url_for('static', filename= kerajinan.gambar) }}"
                        alt="{{ kerajinan.nama }}"
                        class="product-image"
                      />
                      <div>
                        <strong>{{ kerajinan.nama }}</strong> 
                        {% if kerajinan.harga%}
                          - Rp {{ kerajinan.harga }}
                        {% endif %}
                        <p>{{ kerajinan.deskripsi }}</p>
                      </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Tidak ada produk terkait dengan destinasi ini.</p>
        {% endif %}

        <h3 class="detail-section-heading">Tambahkan Ulasan</h3>
            <form method="POST" class="review-form">
                {{ ulasan_form.csrf_token }}
                <div class="form-group">
                    {{ ulasan_form.nama_pengguna.label(class="form-label") }}
                    {{ ulasan_form.nama_pengguna(class="form-control") }}
                </div>
                <div class="form-group">
                    {{ ulasan_form.teks_ulasan.label(class="form-label") }}
                    {{ ulasan_form.teks_ulasan(class="form-control", rows="4") }}
                </div>
                {{ ulasan_form.submit(class="btn btn-primary") }}
            </form>

            <!-- Daftar Ulasan -->
            <h3 class="detail-section-heading">Ulasan</h3>
            {% if ulasan %}
                <ul class="review-list">
                    {% for ulasan_item in ulasan %}
                        <li class="review-item">
                            <strong>{{ ulasan_item.nama_pengguna }}</strong>
                            <small>({{ ulasan_item.tanggal_ulasan }})</small>
                            <p>{{ ulasan_item.teks_ulasan }}</p>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Belum ada ulasan untuk destinasi ini.</p>
            {% endif %}
            
        </div>
      </div>
    </div>
    <!-- Tombol WhatsApp -->
    <a
    href="https://wa.me/{{ destinasi_detail.nomor_telepon }}?text=Saya%20tertarik%20dengan%20produk%20Anda"
    class="whatsapp-button"
    target="_blank"
    >
    <i class="fab fa-whatsapp"></i> Hubungi Kami
    </a>
  </div>
</section>
{% endblock %}